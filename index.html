<!DOCTYPE html>
<!-- index.html -->
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="SortierenV2">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2196f3">
<link rel="apple-touch-icon" href="apple-touch-icon1.png">

  
</head>


<!---========================= HIER HTML ===========================-->

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


  <title>Budget Manager</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


   <!-- ================= POPUP: Einstellungen ================= -->
  <div id="popup2-overlay">
  <div id="popup2">
    <button id="popup2-close">&times;</button>
    <h2>Einstellungen</h2>

    <div class="setting-option" id="open-kategorie-popup">
      <i>📂</i><span>Kategorien verwalten</span>
    </div>
    <div class="setting-option" id="open-kategorie-sortieren-popup">
      <i>↕️</i><span>Kategorien sortieren</span>
    </div>
    <div class="setting-option" id="open-wiederkehrende-popup">
      <i>🔄</i><span>Wiederkehrende Zahlungen</span>
    </div>
    <div class="setting-option" id="open-budget-popup">
      <i>💰</i><span>Budget verwalten</span>
    </div>
    <div class="setting-option" id="open-sparer-popup">
      <i>🏦</i><span>Sparen</span>
    </div>
    <div class="setting-option" id="open-datenexport-popup">
  <i>📤</i><span>Daten exportieren</span>
</div>

  </div>
</div>

  <!-- ================= POPUP: Kategorien-Verwaltung ================= -->
    <!-- Kategorien-Verwaltungs-Popup -->
<!-- Kategorien-Verwaltungs-Popup -->
<div id="kategorie-popup-overlay" class="popup-overlay">
  <div id="kategorie-popup" class="popup-content" role="dialog" aria-modal="true">
    <div class="popup-header">
  <h3 class="popup-title">Kategorien verwalten</h3>
  <button id="kategorie-popup-close" class="popup-close" aria-label="Schließen">&times;</button>
</div>

    <label for="typ-auswahl"></label>
    <select id="typ-auswahl">
      <option value="einnahme">Einzahlung</option>
      <option value="ausgabe">Auszahlung</option>
      <option value="investition">Investition</option>
    </select>

    <input type="text" id="wordInput" placeholder="Wort eingeben" />
    <button id="addWordBtn">Hinzufügen</button>

    <ul id="kategorie-liste"></ul>
  </div>
</div>

<!-- ================= POPUP: Sparer-Verwaltung Start ================= -->
<div id="sparen-popup-overlay" style="display:none;">
  <div id="sparen-popup">
    <button id="sparen-popup-close" title="Schließen">&times;</button>
    <h2>Sparquoten festlegen</h2>

    <div class="sparen-section">
      <div class="sparen-row">
        <label class="sparen-label">Kurzfristig:</label>
        <input type="number" placeholder="Summe (€)" id="kurz-summe" class="summe-input" />
      </div>
    </div>

    <div class="sparen-section">
      <div class="sparen-row">
        <label class="sparen-label">Urlaub:</label>
        <input type="number" placeholder="Summe (€)" id="mittel-summe" class="summe-input" />
      </div>
    </div>

    <div class="sparen-section">
      <div class="sparen-row">
        <label class="sparen-label">Langfristig:</label>
        <input type="number" placeholder="Summe (€)" id="lang-summe" class="summe-input" />
      </div>
    </div>

    <button id="sparen-speichern">Speichern</button>
  </div>
</div>


 <script>
  document.addEventListener("DOMContentLoaded", function () {
    const overlay = document.getElementById("sparen-popup-overlay");
    const openBtn = document.getElementById("open-sparer-popup");
    const closeBtn = document.getElementById("sparen-popup-close");
    const speichernBtn = document.getElementById("sparen-speichern");

    openBtn.addEventListener("click", function (event) {
      if (!event.isTrusted) {
        console.warn("Popup wurde automatisch geöffnet – blockiert.");
        return;
      }

      // gespeicherte Daten laden
      const gespeicherteDaten = JSON.parse(localStorage.getItem("sparquoten"));
      if (gespeicherteDaten) {
        document.getElementById("kurz-summe").value = gespeicherteDaten.kurzSumme || '';
        document.getElementById("mittel-summe").value = gespeicherteDaten.mittelSumme || '';
        document.getElementById("lang-summe").value = gespeicherteDaten.langSumme || '';
      } else {
        // Felder leeren
        ["kurz-summe", "mittel-summe", "lang-summe"].forEach(id => {
          document.getElementById(id).value = '';
        });
      }

      overlay.style.display = "flex";
    });

    closeBtn.addEventListener("click", function () {
      overlay.style.display = "none";
    });

    speichernBtn.addEventListener("click", function () {
      const kurzSumme = document.getElementById("kurz-summe").value.trim();
      const mittelSumme = document.getElementById("mittel-summe").value.trim();
      const langSumme = document.getElementById("lang-summe").value.trim();

      // Optional: hier kannst du noch Validierung hinzufügen, z.B. auf Zahlen oder Mindestwerte

      const daten = {
        kurzSumme,
        mittelSumme,
        langSumme
      };

      localStorage.setItem("sparquoten", JSON.stringify(daten));

      alert("Sparquoten gespeichert!");
      overlay.style.display = "none";
    });

    // Klick außerhalb schließt Popup
    overlay.addEventListener("click", function(event) {
      if (event.target === overlay) {
        overlay.style.display = "none";
      }
    });
  });
</script>



<!-- ================= POPUP: Sparer-Verwaltung Ende ================= -->

<!-- ================= POPUP: Budget-Verwaltung ================= -->
<!-- Budget-Verwaltungs-Popup -->
 <!-- Budget Popup -->
<div id="budget-popup-overlay" class="overlay hidden">
  <div id="budget-popup" class="popup">
    
    <!-- Header mit Schließen-Button und Titel -->
    <div class="popup-header">
      <button class="close-btn" id="budget-close" aria-label="Schließen">&times;</button>
      <h2 class="popup-title">Budget festlegen</h2>
    </div>

   <div id="monatsteuerelemente1">
  <button id="prev-month" aria-label="Vorheriger Monat">&#x25C0;</button>
  <div id="monat-anzeige">August 2025</div>
  <button id="next-month" aria-label="Nächster Monat">&#x25B6;</button>
</div>


    <!-- Budget-Eingabe -->
    <input type="number" id="budget-input" placeholder="z. B. 1500 €" />

    <!-- Button: Vorgeschlagenes Budget übernehmen -->
<button id="uebernehme-vorgeschlagenes-budget" class="secondary-btn">Vorgeschlagenes Budget</button>
<!-- Neuer Button: Vorgeschlagenes Budget minus Sparsumme -->
<button id="uebernehme-budget-minus-sparen" class="secondary-btn" style="margin-left: 10px;">Sparbetrag beachten</button>





    <!-- Buttons -->
    <div class="budget-buttons">
      <button id="save-budget">Speichern</button>
      <button id="clear-budget">Löschen</button>
    </div>

    <!-- Budget-Übersicht -->
    <div id="budget-uebersicht" class="budget-uebersicht">
      
      <p><span>Feste Einnahmen:</span> <span class="betrag" id="wk-einnahmen">– €</span></p>
      <p><span>Zusätzliche Einnahmen:</span> <span class="betrag" id="zusatz-einnahmen">– €</span></p>
      <p><span>Feste Ausgaben:</span> <span class="betrag" id="wk-ausgaben">– €</span></p>
      <p><span>Investitionen:</span> <span class="betrag" id="investition">– €</span></p>
      <p><span>Vorgeschlagenes Budget:</span> <span class="betrag" id="vorgeschlagenes-budget">– €</span></p>
    </div>

  </div>
</div>

<!-- Budget-Verwaltungs Popup Ende -->

<!-- ================= POPUP: Wiederkehrende Zahlungen ================= -->
<div id="wiederkehrende-popup-overlay" class="overlay hidden">
  <div id="wiederkehrende-popup" class="popup">
    <button class="close-btn" id="wiederkehrende-close">×</button>
    <h2>Wiederkehrende Zahlung</h2>

    <!-- Buttons für Typ -->
    <div id="typ-buttons">
      <button type="button" class="typ-btn" data-typ="einnahme">Einzahlung</button>
      <button type="button" class="typ-btn" data-typ="investition">Invest</button>
      <button type="button" class="typ-btn" data-typ="ausgabe">Auszahlung</button>
    </div>

    <!-- Verstecktes Input für Typ -->
    <input type="hidden" id="wiederkehrende-typ" required>

    <form id="wiederkehrende-form">
      <table>
        <tr>
          <td colspan="2">
            <div class="betrag-row">
              <label for="wiederkehrende-betrag">Betrag (€):</label>
              <input type="text" id="wiederkehrende-betrag" required readonly />
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div id="vk-wiederkehrende" class="virtual-keyboard" style="display:none;">
              <div class="vk-row">
                <button type="button" class="vk-btn operator">+</button>
                <button type="button" class="vk-btn operator">-</button>
                <button type="button" class="vk-btn operator">×</button>
                <button type="button" class="vk-btn operator">÷</button>
              </div>
              <div class="vk-row">
                <button type="button" class="vk-btn">7</button>
                <button type="button" class="vk-btn">8</button>
                <button type="button" class="vk-btn">9</button>
                <button type="button" id="vk-equal" class="vk-btn operator">=</button>
              </div>
              <div class="vk-row">
                <button type="button" class="vk-btn">4</button>
                <button type="button" class="vk-btn">5</button>
                <button type="button" class="vk-btn">6</button>
                <button type="button" class="vk-btn comma">.</button>
              </div>
              <div class="vk-row">
                <button type="button" class="vk-btn">1</button>
                <button type="button" class="vk-btn">2</button>
                <button type="button" class="vk-btn">3</button>
                <button type="button" id="vk-backspace" class="vk-btn backspace">←</button>
              </div>
              <div class="vk-row">
                <div style="flex:1"></div>
                <button type="button" class="vk-btn">0</button>
                <div style="flex:1"></div>
                <button type="button" id="vk-ok" class="vk-btn ok-btn">OK</button>
              </div>
            </div>
          </td>
        </tr>
        
        <tr>
  <tr>
  <td colspan="2">
    <div class="kategorie-row2">
      <label for="wiederkehrende-kategorie">Kategorie:</label>
      <select id="wiederkehrende-kategorie" required>
  <option disabled selected>Keine Kategorien verfügbar</option>
</select>

    </div>
  </td>
</tr>

        </tr>
        <tr>
          <td colspan="2">
            <div class="intervall-row">
            <label for="wiederkehrende-intervall">Intervall:</label>
            <select id="wiederkehrende-intervall" required>
              <option value="Monatsende">Monatsende</option>
              <option value="Jahresende">Jahresende</option>
              <option value="Wochenende">Wochenende</option>
              <option value="Monatsanfang">Monatsanfang</option>
              <option value="Jahresanfang">Jahresanfang</option>
              <option value="Wochenanfang">Wochenanfang</option>
            </select>
            </div>
          </td>
        </tr>
        
  <tr>
      <td colspan="2">
        <div class="von-row">
          <label for="wiederkehrende-start">Von:</label>
          <input type="date" id="wiederkehrende-start" required />
        </div>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <div class="bis-row">
          <label for="wiederkehrende-ende">Bis:</label>
          <input type="date" id="wiederkehrende-ende" required />
        </div>
      </td>
    </tr>
        <tr>
  <td colspan="2" style="padding-bottom: 10px;">
    <button type="submit" id="speichern-btn">Speichern</button>
  </td>
</tr>
<!-- Button zum Öffnen des gespeicherten Einträge-Popups -->
<tr>
  <td colspan="2" style="padding-top: 0;">
    <button type="button" id="show-eintraege-btn">Gespeicherte Einträge anzeigen</button>
  </td>
</tr>
      </table>
    </form>

  </div>
</div>


<!-- Neues Popup für gespeicherte Einträge -->
<div id="eintraege-popup-overlay" class="overlay hidden">
  <div class="popup" style="max-width: 400px; max-height: 80vh; overflow-y: auto;">
    <button class="close-btn" id="eintraege-close">×</button>
    <h3>Gespeicherte Einträge</h3>
    <ul id="wiederkehrende-liste" style="max-height: 60vh; overflow-y: auto;"></ul>
  </div>
</div>


<!-- ================= POPUP: Wiederkehrende Zahlungen Ende ================= -->



<!-- ================= POPUP: Kategorien sortieren Start ================= -->
<!-- Kategorien-Sortieren-Popup -->
<div id="kategorie-sortieren-popup-overlay" style="
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
  z-index: 1100;
">
  <div id="kategorie-sortieren-popup" style="
    background: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 700px;
    width: 95%;
    max-height: 90%;
    overflow-y: auto;
    position: relative;
  ">
    <div class="popup-header">
  <h3 class="popup-title">Kategorien sortieren & gruppieren</h3>
  
  <button id="kategorie-sortieren-popup-close" class="close-btn" aria-label="Schließen">&times;</button>
</div>

<!-- Schalter für sortieren -->
 <div style="margin: 10px 0; text-align: center;">
  <label class="toggle-switch">
    <input type="checkbox" id="sortier-schalter">
    <span class="slider"></span>
    <span class="switch-label"></span>
  </label>
</div>




    <div style="text-align: center; margin-bottom: 20px;">
  <button id="sort-tab-einnahme" class="sort-tab active einnahme">Einzahlungen</button>
  <button id="sort-tab-investition" class="sort-tab investition">Invest</button>
  <button id="sort-tab-ausgabe" class="sort-tab ausgabe">Auszahlungen</button>
  
</div>


    <div id="sortier-container" class="sortier-wrapper"></div>

    <button id="add-group-btn" style="margin-top: 15px;">Neue Oberkategorie</button>
  </div>
</div>




<!-- ================= POPUP: Kategorien sortieren Ende ================= -->

<!-- ================= POPUP: Datenexport Start ================= -->

<div id="popup-datenexport-overlay" style="display:none;">
  <div id="popup-datenexport">
    <div class="popup-header">
      <h2>Daten exportieren</h2>
      <span id="popup-datenexport-close" class="popup-close">&times;</span>
    </div>
    
    <div class="popup-body">
      <label for="export-start">Startdatum</label>
      <input type="date" id="export-start">

      <label for="export-ende">Enddatum</label>
      <input type="date" id="export-ende">
    </div>

    <div class="popup-footer">
      <button id="export-daten-btn" class="export-btn">📤 Exportieren</button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const openBtn = document.getElementById("open-datenexport-popup");
  const closeBtn = document.getElementById("popup-datenexport-close");
  const overlay = document.getElementById("popup-datenexport-overlay");
  const exportBtn = document.getElementById("export-daten-btn");
  const popup = document.getElementById("popup-datenexport");

  // Öffnen
  openBtn.addEventListener("click", () => {
    overlay.style.display = "flex"; // Flex für Centering
  });

  // Schließen (Kreuz)
  closeBtn.addEventListener("click", () => {
    overlay.style.display = "none";
  });

  // Schließen bei Klick außerhalb
  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) {
      overlay.style.display = "none";
    }
  });

  // Export-Logik
  exportBtn.addEventListener("click", () => {
    const start = new Date(document.getElementById("export-start").value);
    const ende = new Date(document.getElementById("export-ende").value);

    const einmalige = JSON.parse(localStorage.getItem("eintraege")) || [];
    const wiederkehrende = JSON.parse(localStorage.getItem("wiederkehrendeEintraege")) || [];

    const gefiltertEinmalig = einmalige.filter(e => {
      const d = new Date(e.datum);
      return d >= start && d <= ende;
    });

    const gefiltertWiederkehrend = wiederkehrende.filter(e => {
      const startDatum = new Date(e.start);
      const endeDatum = new Date(e.ende);
      return (start <= endeDatum) && (ende >= startDatum);
    });

    const exportData = {
      einmalige: gefiltertEinmalig,
      wiederkehrende: gefiltertWiederkehrend
    };

    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = `datenexport_${start.toISOString().split('T')[0]}_${ende.toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);

    alert("Export abgeschlossen!");
  });
});

</script>

<!-- ================= POPUP: Datenexport Ende ================= -->









  </div>

  <script>
    // Auslagerung 1.1
    // Auslagerung 1.2
  </script>

  <div id="header">
  <div id="refresh-icon" title="Seite aktualisieren" role="button" tabindex="0">&#10227;</div>
  <h1>Budget Manager</h1>
  <div id="settings-icon" title="Einstellungen" role="button" tabindex="0">&#9776;</div>
</div>

<script>
  // Warten bis DOM geladen ist
  document.addEventListener('DOMContentLoaded', () => {
    const refreshBtn = document.getElementById('refresh-icon');

    refreshBtn.addEventListener('click', () => {
      location.reload();
    });

    // Für Tastaturbedienung (Enter oder Space)
    refreshBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        location.reload();
      }
    });
  });
</script>





<!-- ================= Tabs für Navigation ================= -->
  <!-- Tabs -->
  <div id="tabs" class="tab-container">
  <div class="tab-button" id="tab-kalender">
    <div>📅</div>
    <small>Kalender</small>
  </div>
  <div class="tab-button" id="tab-statistik">
    <div>📊</div>
    <small>Statistik</small>
  </div>
  <div class="tab-button" id="tab-uebersicht">
    <div>📋</div>
    <small>Übersicht</small>
  </div>
  <div class="tab-button" id="tab-notizen">
    <div>📝</div>
    <small>Notizen</small>
  </div>
</div>


   <!-- ================= Tab-Inhalte ================= -->
  <div id="tab-content">
    <!-- ========== Kalender-Tab ========== -->
    <!-- Kalender Tab -->
    <div id="tab-content-kalender" class="active">
      <form id="form">
        
        <input type="date" id="datum" required style="display:none;" />

        <!--<button type="submit">Hinzufügen</button> -->
      </form>


  <!-- Fixierter oberer Bereich -->
  <div id="fixed-top-container">

    

    <!-- Monatsübersicht -->
    <div id="monatsuebersicht">
  <div class="uebersicht-feld einnahmen">
    <strong>Einnahmen</strong><br>
    <span id="monat-einnahmen">0.00 €</span>
  </div>
  <div class="uebersicht-feld budget">
    <strong>Budget</strong><br>
    <span id="monat-budget">0.00 €</span>
  </div>
  <div class="uebersicht-feld ausgaben">
    <strong>Ausgaben</strong><br>
    <span id="monat-ausgaben">0.00 €</span>
  </div>
</div>


    <!-- Budget-Slider -->
    <div id="budget-progress-container">
      <div id="budget-bar-background">
        <div id="budget-bar-fill"></div>
        <div id="budget-time-marker"></div>
      </div>
      <div id="budget-stand-text"></div>
    </div>

    <!-- Monatsnavigation (fixiert) -->
<div id="monatsteuerelemente">
  <button id="vorherigerMonat" aria-label="Vorheriger Monat">&#x25C0;</button> <!-- ◀ -->
  <div id="monatanzeige">Juli 2025</div>
  <button id="naechsterMonat" aria-label="Nächster Monat">&#x25B6;</button> <!-- ▶ -->
</div>


  </div>

  <!-- Scrollbarer Inhalt darunter -->
  <div id="scroll-content">
  <div id="wochentage">
    <div>Mo</div>
    <div>Di</div>
    <div>Mi</div>
    <div>Do</div>
    <div>Fr</div>
    <div>Sa</div>
    <div>So</div>
  </div>
  <div id="kalender"></div>
  <div></div>
  <h2 style="font-size: 20px;">Einträge für ausgewählten Tag</h2>


  <ul id="liste"></ul>
</div>

</body>
    </div>


<!-- ========== Statistik-Tab ========== -->
   <div id="tab-content-statistik">
      
<div id="fixed-container-statistik">
      

<!-- Zeitraum Auswahl & Navigation im Statistik-Tab -->
<!-- Zeitraum Auswahl im Button-Stil -->
<div id="zeitraum-auswahl-buttons">
  <button data-modus="woche" class="zeitraum-button">Woche</button>
  <button data-modus="monat" class="zeitraum-button active">Monat</button>
  <button data-modus="jahr" class="zeitraum-button">Jahr</button>
</div>

<!-- Zeitraum Navigation -->
<div id="zeitraum-navigation">
  <button id="zeitraum-zurueck" class="nav-button">&#x25C0;</button>
  <span id="zeitraum-anzeige">Juli 2025</span>
  <button id="zeitraum-vor" class="nav-button">&#x25B6;</button>
</div>





<!-- Slider Ein- Ausgaben -->
      <div class="container">
  <div class="nav" id="nav">
    <div data-pos="0">Einnahmen</div>
    <div data-pos="1">Budget</div>
    <div data-pos="2">Ausgaben</div>
    <div class="underline"></div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
  const nav = document.getElementById('nav');
  const underline = nav.querySelector('.underline');
  const items = nav.querySelectorAll('div[data-pos]');
  
  items.forEach(item => {
    item.addEventListener('click', () => {
      const pos = parseInt(item.getAttribute('data-pos'));
      underline.style.left = (pos * 33.3333) + '%';
    });
  });
  const chartSections = {
  0: document.getElementById('chart-einnahmen'),
  1: document.getElementById('chart-budget'),
  2: document.getElementById('chart-ausgaben')
};

let aktiverChartIndex = 0;

items.forEach(item => {
  item.addEventListener('click', () => {
    const pos = parseInt(item.getAttribute('data-pos'));
    underline.style.left = (pos * 33.3333) + '%';

    // Sichtbarkeit der Chart-Sektionen steuern
    chartSections[aktiverChartIndex].style.display = 'none';
    chartSections[pos].style.display = 'block';
    aktiverChartIndex = pos;

    // Optional: Daten für den neuen Graphen laden
    ladeStatistikGraph();
  });
});
});

// Aus Übersicht-Tab übernehmen
function berechneZeitraum(modus, basisDatum) {
  const start = new Date(basisDatum);
  const end = new Date(basisDatum);

  if (modus === 'monat') {
    start.setDate(1);
    end.setMonth(start.getMonth() + 1);
    end.setDate(0);
  } else if (modus === 'jahr') {
    start.setMonth(0, 1);
    end.setMonth(11, 31);
    const heute = new Date();
    if (basisDatum.getFullYear() === heute.getFullYear()) {
      end.setMonth(heute.getMonth() + 1, 0);
    }
  } else { // Woche
    const diff = basisDatum.getDay() === 0 ? -6 : 1 - basisDatum.getDay();
    start.setDate(start.getDate() + diff);
    end.setDate(start.getDate() + 6);
  }

  start.setHours(0, 0, 0, 0);
  end.setHours(23, 59, 59, 999);
  return { start, end };
}



</script>
</div>
      <!-- Slider Ein- Ausgaben Ende -->
     
      <div id="scroll-content-uebersicht">
<!-- Statistik-Graphen -->
<div id="statistik-graph-container">
  <div id="chart-einnahmen" class="chart-section">
    📈 Graph für Einnahmen
    <canvas id="chart" width="700" height="300" style="border:1px solid #ccc; border-radius:6px;"></canvas>
  </div>
  <div id="chart-budget" class="chart-section" style="display: none;">
    <div id="ueberschuss-anzeige" class="ueberschuss-box">
  <h3>💰 Überschuss-Analyse</h3>
  <ul>
    <li><span>1. Gesamtüberschuss:</span> <strong id="stufe1">0 €</strong></li>
    <li><span>2. Nach kurzfristigem Sparen:</span> <strong id="stufe2">0 €</strong></li>
    <li><span>3. Nach Urlaubrücklagen:</span> <strong id="stufe3">0 €</strong></li>
    <li><span>4. Nach langfristigem Sparen:</span> <strong id="stufe4">0 €</strong></li>
  </ul>
</div>
</div>  
  <div id="chart-ausgaben" class="chart-section" style="display: none;">📉 Graph für Ausgaben</div>
</div>

</div>
    </div>
  </div>

<script>

function berechneUndZeigeUeberschuss(zeitraumStart, zeitraumEnde, modus) {
  const result = berechneGesamtUeberschuss(zeitraumStart, zeitraumEnde, modus); 

  // Sparsummen (Monatsbasis) aus LocalStorage
  const sparquoten = JSON.parse(localStorage.getItem("sparquoten")) || {};
  let kurz = parseFloat(sparquoten.kurzSumme) || 0;
  let mittel = parseFloat(sparquoten.mittelSumme) || 0;
  let lang = parseFloat(sparquoten.langSumme) || 0;

  // Jahresmodus → Sparsummen hochrechnen
  if (modus === "jahr") {
    const heute = new Date();
    const anzahlMonate = (zeitraumEnde.getFullYear() === heute.getFullYear())
      ? heute.getMonth() + 1
      : 12;
    kurz *= anzahlMonate;
    mittel *= anzahlMonate;
    lang *= anzahlMonate;
  }

  // Berechnungen
  const stufe1 = result.ueberschuss;
  const stufe2 = stufe1 - kurz;
  const stufe3 = stufe2 - mittel;
  const stufe4 = stufe3 - lang;

  // Werte ins UI schreiben mit Farb-Logik
  setzeWert("stufe1", stufe1);
  setzeWert("stufe2", stufe2);
  setzeWert("stufe3", stufe3);
  setzeWert("stufe4", stufe4);
}

// Hilfsfunktion für einheitliche Formatierung
function setzeWert(id, betrag) {
  const el = document.getElementById(id);
  const formatierterBetrag = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(betrag);
  el.innerText = `${formatierterBetrag} €`;
  el.classList.toggle("negativ", betrag < 0);
}


// Gesamtüberschuss berechnen
function berechneGesamtUeberschuss(zeitraumStart, zeitraumEnde, modus) {

  const einmalige = JSON.parse(localStorage.getItem("eintraege")) || [];
  const wiederkehrende = JSON.parse(localStorage.getItem("wiederkehrendeEintraege")) || [];
  const toDate = (str) => new Date(str + "T00:00:00");

  let startEinmalige = zeitraumStart;
  let endEinmalige = zeitraumEnde;

  if (modus === "jahr") {
    // Ganzes Kalenderjahr vom zeitraumStart-Jahr nehmen
    const jahr = zeitraumStart.getFullYear();
    startEinmalige = new Date(jahr, 0, 1, 0, 0, 0, 0);
    endEinmalige = new Date(jahr, 11, 31, 23, 59, 59, 999);
  }

  const relevanteEintraege = [
    ...einmalige.filter(e => {
      const d = toDate(e.datum);
      return d >= startEinmalige && d <= endEinmalige;
    })
  ];

  // Wiederkehrende berücksichtigen (bis zeitraumEnde, also aktueller Monat im Jahr)
  wiederkehrende.forEach(e => {
    const start = toDate(e.start);
    const ende = toDate(e.ende);
    const betrag = parseFloat(e.betrag);

    let lauf = new Date(zeitraumStart);
    while (lauf <= zeitraumEnde) {
      if (lauf >= start && lauf <= ende && istIntervallFuerDatum(e.intervall, lauf)) {
        relevanteEintraege.push({
          typ: e.typ,
          betrag,
          kategorie: e.kategorie,
          datum: lauf.toISOString().split("T")[0]
        });
      }
      lauf.setDate(lauf.getDate() + 1);
    }
  });

  // Summen berechnen
  let einnahmen = 0, ausgaben = 0, investitionen = 0;
  relevanteEintraege.forEach(e => {
    const betrag = parseFloat(e.betrag);
    if (e.typ === "einnahme") einnahmen += betrag;
    else if (e.typ === "ausgabe") ausgaben += betrag;
    else if (e.typ === "investition") investitionen += betrag;
  });

  return {
    einnahmen,
    ausgaben,
    investitionen,
    ueberschuss: einnahmen - ausgaben - investitionen
  };
}


document.addEventListener("DOMContentLoaded", () => {
  let statistikDatum = new Date();
  let statistikModus = "monat";

  const updateAnzeige = () => {
    const { start, end } = berechneZeitraum(statistikModus, statistikDatum);
    berechneUndZeigeUeberschuss(start, end, statistikModus);
  };

  // Buttons (Woche/Monat/Jahr)
  document.querySelectorAll('.zeitraum-button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.zeitraum-button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      statistikModus = btn.getAttribute('data-modus');
      updateAnzeige();
    });
  });

  // Navigation (vor/zurück)
  document.getElementById("zeitraum-zurueck").addEventListener("click", () => {
    if (statistikModus === "jahr") statistikDatum.setFullYear(statistikDatum.getFullYear() - 1);
    else if (statistikModus === "monat") statistikDatum.setMonth(statistikDatum.getMonth() - 1);
    else statistikDatum.setDate(statistikDatum.getDate() - 7);
    updateAnzeige();
  });

  document.getElementById("zeitraum-vor").addEventListener("click", () => {
    if (statistikModus === "jahr") statistikDatum.setFullYear(statistikDatum.getFullYear() + 1);
    else if (statistikModus === "monat") statistikDatum.setMonth(statistikDatum.getMonth() + 1);
    else statistikDatum.setDate(statistikDatum.getDate() + 7);
    updateAnzeige();
  });

  updateAnzeige();
});



</script>

</div>

<!-- ======================================= Statistik-Tab Ende ======================================= -->

<!-- ======================================= Übersicht-Tab Start ======================================= -->

<div id="tab-content" style="margin-top: 100px;">
  <div id="tab-content-uebersicht" class="active">

   <!-- Fixierter oberer Bereich -->
  <div id="fixed-container-uebersicht">

    <!-- Zeitraum Auswahl Übersicht -->
    <div id="uebersicht-zeitraum-auswahl-buttons">
      <button data-modus="woche" class="uebersicht-zeitraum-button">Woche</button>
      <button data-modus="monat" class="uebersicht-zeitraum-button active">Monat</button>
      <button data-modus="jahr" class="uebersicht-zeitraum-button">Jahr</button>
    </div>

    <!-- Navigation Übersicht -->
    <div id="uebersicht-zeitraum-navigation">
      <button id="uebersicht-zeitraum-zurueck" class="nav-button">&#x25C0;</button>
      <span id="uebersicht-zeitraum-anzeige">Juli 2025</span>
      <button id="uebersicht-zeitraum-vor" class="nav-button">&#x25B6;</button>
    </div>

    <!-- Slider Übersicht -->
    <div class="container">
      <div class="nav" id="uebersicht-nav">
        <div data-pos="0">Einnahmen</div>
        <div data-pos="1">Invest</div>
        <div data-pos="2">Ausgaben</div>
        <div class="underline"></div>
      </div>
    </div>
</div>

<!-- Scrollbarer Inhalt darunter -->
  <div id="scroll-content-uebersicht">

    <!-- Graph-Container -->
<div id="uebersicht-graph-container">
      <div id="uebersicht-chart-einnahmen" class="chart-section">
        <!-- 📈 Übersicht Einnahmen -->
        <div id="einnahmen-list" style="margin-top: 20px;"></div>
        <div id="test-einnahmen-august" style="margin-top: 0px; padding: 0;">
          <div id="einnahmen-list-august"></div>
        </div>
      </div>
      <div id="uebersicht-chart-invest" class="chart-section" style="display: none;">
        <!-- 📊 Übersicht Invest -->
        <div id="invest-list" style="margin-top: 20px;"></div>
      </div>
      <div id="uebersicht-chart-ausgaben" class="chart-section" style="display: none;">
        <!-- 📉 Übersicht Ausgaben -->
        <div id="ausgaben-list" style="margin-top: 20px;"></div>
      </div>
    </div>
  </div>
    <!-- Script -->
<script>

function istIntervallFuerDatum(intervall, datum) {
  const tag = datum.getDay();
  const tagDesMonats = datum.getDate();
  const monat = datum.getMonth();
  const jahr = datum.getFullYear();

  return (
    (intervall === "Monatsanfang" && tagDesMonats === 1) ||
    (intervall === "Monatsende" && tagDesMonats === new Date(jahr, monat + 1, 0).getDate()) ||
    (intervall === "Jahresanfang" && tagDesMonats === 1 && monat === 0) ||
    (intervall === "Jahresende" && tagDesMonats === 31 && monat === 11) ||
    (intervall === "Wochenanfang" && tag === 1) ||
    (intervall === "Wochenende" && (tag === 0 || tag === 6))
  );
}




document.addEventListener('DOMContentLoaded', () => {
    let uebersichtDatum = new Date();
    let uebersichtModus = 'monat';
    let uebersichtAktiverChartIndex = 0;

    const uebersichtAnzeige = document.getElementById('uebersicht-zeitraum-anzeige');
    const btnZurueck = document.getElementById('uebersicht-zeitraum-zurueck');
    const btnVor = document.getElementById('uebersicht-zeitraum-vor');
    const nav = document.getElementById('uebersicht-nav');
    const underline = nav.querySelector('.underline');
    const items = nav.querySelectorAll('div[data-pos]');

    const chartSections = {
        0: document.getElementById('uebersicht-chart-einnahmen'),
        1: document.getElementById('uebersicht-chart-invest'),
        2: document.getElementById('uebersicht-chart-ausgaben')
    };

    items.forEach(item => {
        item.addEventListener('click', () => {
            const pos = parseInt(item.getAttribute('data-pos'));
            underline.style.left = (pos * 33.3333) + '%';

            Object.values(chartSections).forEach(section => section.style.display = 'none');
            chartSections[pos].style.display = 'block';
            uebersichtAktiverChartIndex = pos;

            ladeUebersichtGraph();
        });
    });

    function updateUebersichtAnzeige() {
        if (uebersichtModus === 'jahr') {
            uebersichtAnzeige.textContent = uebersichtDatum.getFullYear();
        } else if (uebersichtModus === 'monat') {
            uebersichtAnzeige.textContent = uebersichtDatum.toLocaleString('de-DE', { month: 'long', year: 'numeric' });
        } else {
            const start = new Date(uebersichtDatum);
            const end = new Date(uebersichtDatum);
            start.setDate(start.getDate() - start.getDay() + 1);
            end.setDate(start.getDate() + 6);
            uebersichtAnzeige.textContent = `${start.toLocaleDateString('de-DE')} – ${end.toLocaleDateString('de-DE')}`;
        }
    }

    btnZurueck.addEventListener('click', () => {
        if (uebersichtModus === 'jahr') uebersichtDatum.setFullYear(uebersichtDatum.getFullYear() - 1);
        else if (uebersichtModus === 'monat') uebersichtDatum.setMonth(uebersichtDatum.getMonth() - 1);
        else uebersichtDatum.setDate(uebersichtDatum.getDate() - 7);
        updateUebersichtAnzeige();
        ladeUebersichtGraph();
    });

    btnVor.addEventListener('click', () => {
        if (uebersichtModus === 'jahr') uebersichtDatum.setFullYear(uebersichtDatum.getFullYear() + 1);
        else if (uebersichtModus === 'monat') uebersichtDatum.setMonth(uebersichtDatum.getMonth() + 1);
        else uebersichtDatum.setDate(uebersichtDatum.getDate() + 7);
        updateUebersichtAnzeige();
        ladeUebersichtGraph();
    });

    document.querySelectorAll('.uebersicht-zeitraum-button').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.uebersicht-zeitraum-button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            uebersichtModus = btn.getAttribute('data-modus');
            updateUebersichtAnzeige();
            ladeUebersichtGraph();
        });
    });

    function parseDate(d) {
        return new Date(d + "T00:00:00");
    }

    function berechneZeitraum(modus, basisDatum) {
  const start = new Date(basisDatum);
  const end = new Date(basisDatum);

  if (modus === 'monat') {
    start.setDate(1);
    end.setMonth(start.getMonth() + 1);
    end.setDate(0);
  } else if (modus === 'jahr') {
    start.setMonth(0, 1);

    // Wenn das Basisjahr aktuell ist, Enddatum = letzter Tag aktueller Monat
    const heute = new Date();
    if (basisDatum.getFullYear() === heute.getFullYear()) {
      end.setMonth(heute.getMonth() + 1, 0);
    } else {
      // Für vergangene oder zukünftige Jahre nimm komplettes Jahr
      end.setMonth(11, 31);
    }
  } else { // Woche
    const diff = basisDatum.getDay() === 0 ? -6 : 1 - basisDatum.getDay();
    start.setDate(start.getDate() + diff);
    end.setDate(start.getDate() + 6);
  }

  start.setHours(0, 0, 0, 0);
  end.setHours(23, 59, 59, 999);
  return { start, end };
}



    function istEintragImZeitraumWiederkehrend(eintrag, start, end) {
    const intervallTyp = eintrag.intervall;
    const startDatum = new Date(eintrag.start);
    const endDatum = new Date(eintrag.ende);
    
    if (endDatum < start || startDatum > end) return false;

    const aktuelle = new Date(startDatum);

    while (aktuelle <= end && aktuelle <= endDatum) {
        const tag = aktuelle.getDay();
        const datum = aktuelle.getDate();
        const monat = aktuelle.getMonth();
        const jahr = aktuelle.getFullYear();

        const istGültig =
            (intervallTyp === "Monatsanfang" && datum === 1) ||
            (intervallTyp === "Monatsende" && datum === new Date(jahr, monat + 1, 0).getDate()) ||
            (intervallTyp === "Jahresanfang" && datum === 1 && monat === 0) ||
            (intervallTyp === "Jahresende" && datum === 31 && monat === 11) ||
            (intervallTyp === "Wochenanfang" && tag === 1) ||
            (intervallTyp === "Wochenende" && (tag === 0 || tag === 6));

        if (istGültig && aktuelle >= start && aktuelle <= end) {
            return true;
        }

        // Springe zum nächsten möglichen Datum basierend auf Intervall
        if (intervallTyp.startsWith("Monat")) {
            aktuelle.setMonth(aktuelle.getMonth() + 1);
            aktuelle.setDate(1);
        } else if (intervallTyp.startsWith("Jahr")) {
            aktuelle.setFullYear(aktuelle.getFullYear() + 1);
            aktuelle.setMonth(0, 1);
        } else {
            aktuelle.setDate(aktuelle.getDate() + 1);
        }
    }

    return false;
}

function ladeUebersichtGraph() {
  const { start, end } = berechneZeitraum(uebersichtModus, new Date(uebersichtDatum));
  const einmalige = JSON.parse(localStorage.getItem("eintraege") || "[]");
  const wiederkehrende = JSON.parse(localStorage.getItem("wiederkehrendeEintraege") || "[]");

  const berechneSummen = (typ) => {
  const map = new Map();
  let filterStart = start;
let filterEnd = end;

if (uebersichtModus === "jahr") {
  const jahr = start.getFullYear();
  filterStart = new Date(jahr, 0, 1);        // 1. Jan
  filterEnd = new Date(jahr, 11, 31, 23, 59, 59, 999);  // 31. Dez, Ende Tag
}

const einmaligGefiltert = einmalige.filter(e => {
  if (e.typ !== typ) return false;
  const datum = new Date(e.datum + "T00:00:00");
  return datum >= filterStart && datum <= filterEnd;
});

  const gruppenMap = new Map();

  const istSortiert = istSortierModusAktiv();
  const gruppenDesTyps = gruppen[typ] || [];

  // Hilfsfunktion: Finde Gruppennamen zu einer Kategorie
  const findeGruppe = (kategorie) => {
    for (const gruppe of gruppenDesTyps) {
      if (gruppe.items.includes(kategorie)) return gruppe.name;
    }
    return null;
  };

  // === Einmalige Einträge ===
  einmaligGefiltert.forEach(e => {
    const kategorie = e.kategorie;
    const betrag = parseFloat(e.betrag);
    const ziel = istSortiert ? (findeGruppe(kategorie) || "Nicht gruppiert") : kategorie;
    map.set(ziel, (map.get(ziel) || 0) + betrag);
  });

  // === Wiederkehrende Einträge ===
  wiederkehrende
    .filter(e => e.typ === typ)
    .forEach(e => {
      const startDatum = new Date(e.start);
      const endDatum = new Date(e.ende);
      const betrag = parseFloat(e.betrag);
      const aktuelle = new Date(start);

      while (aktuelle <= end) {
        const kopie = new Date(aktuelle);

        if (kopie >= startDatum && kopie <= endDatum && istIntervallFuerDatum(e.intervall, kopie)) {
          const kategorie = e.kategorie;
          const ziel = istSortiert ? (findeGruppe(kategorie) || "Nicht gruppiert") : kategorie;
          map.set(ziel, (map.get(ziel) || 0) + betrag);
        }

        aktuelle.setDate(aktuelle.getDate() + 1);
      }
    });

  return Array.from(map.entries()).sort((a, b) => b[1] - a[1]);
};



const renderListe = (zielId, daten, typ) => {
  const container = document.getElementById(zielId);
  container.innerHTML = "";

  if (daten.length === 0) {
    container.textContent = `Keine ${typ} im ausgewählten Zeitraum.`;
    return;
  }

  // Gesamtbetrag berechnen
  const gesamt = daten.reduce((sum, [, betrag]) => sum + betrag, 0);

  // Farbauswahl je nach Typ
  const farbe = typ === "einnahmen" ? "green" :
                typ === "ausgaben" ? "red" :
                typ === "investitionen" ? "#6f42c1" : "#333";

  // Gesamtsummenanzeige
  const summeDiv = document.createElement("div");
  summeDiv.textContent = `${gesamt.toLocaleString("de-DE", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  })} €`;
  summeDiv.style.fontSize = "17px";
  summeDiv.style.fontWeight = "bold";
  summeDiv.style.color = farbe;
  summeDiv.style.marginBottom = "12px";
  summeDiv.style.fontFamily = "sans-serif";
  summeDiv.classList.add("gesamt-summe");

  container.appendChild(summeDiv);

  // Kategorie-Liste rendern
  const liste = document.createElement("div");
  liste.style.display = "flex";
  liste.style.flexDirection = "column";
  liste.style.gap = "10px";

  daten.forEach(([kategorie, summe]) => {
    const zeile = document.createElement("div");
    zeile.style.display = "flex";
    zeile.style.justifyContent = "space-between";
    zeile.style.alignItems = "center";
    zeile.style.padding = "8px 12px";
    zeile.style.borderBottom = "1px solid #eee";
    zeile.style.backgroundColor = "#fff";
    zeile.style.borderRadius = "6px";
    zeile.style.boxShadow = "0 1px 3px rgba(0, 0, 0, 0.05)";
    zeile.style.fontFamily = "sans-serif";
    zeile.style.fontSize = "15px";

    const kategorieSpan = document.createElement("span");
    kategorieSpan.textContent = kategorie;
    kategorieSpan.style.fontWeight = "500";

    const betragSpan = document.createElement("span");
    betragSpan.textContent = `${typ === "einnahmen" ? "" : ""}${summe.toLocaleString("de-DE", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    })} €`;
    betragSpan.style.fontWeight = "bold";
    betragSpan.style.color = farbe;

    zeile.appendChild(kategorieSpan);
    zeile.appendChild(betragSpan);
    liste.appendChild(zeile);
  });

  container.appendChild(liste);
};



  renderListe("einnahmen-list-august", berechneSummen("einnahme"), "einnahmen");
  renderListe("ausgaben-list", berechneSummen("ausgabe"), "ausgaben");
  renderListe("invest-list", berechneSummen("investition"), "investitionen");
}



    updateUebersichtAnzeige();
    ladeUebersichtGraph();

});


</script>
</div>

<!-- ======================================= Übersicht-Tab Ende ======================================= -->


<!-- ======================================= Notizen-Tab ======================================= -->
<div id="tab-content-notizen" style="display: none;">

    <!-- Fixierter Titel -->
    

    <!-- Scrollbarer Inhalt -->
    <div id="scroll-content-notizen">

        <!-- Notizfeld -->
        <label for="notizen-textarea" style="font-weight: 600; display:block; margin-bottom: 6px;">Notizen</label>
        <textarea id="notizen-textarea" placeholder="Hier schreiben... (z.B. 2+3=)"></textarea>

        <hr style="margin: 24px 0; border: none; border-top: 1px solid #e5e7eb;">

        <!-- Schulden-Tracker -->
        <h4 style="margin-bottom: 8px;">Schulden-Tracker</h4>
        <div id="schuld-inputs">
            <input id="schuld-name" type="text" placeholder="Name" style="flex: 2;">
            <input id="schuld-betrag" type="number" step="0.01" placeholder="Betrag" style="flex: 1;">
            <button id="schuld-add">➕</button>
        </div>
        <div id="schuld-liste" style="display: flex; flex-direction: column; gap: 8px;"></div>
        <div id="schuld-summe"></div>

        <div id="schuld-modal">
    <div id="schuld-modal-content">
        <h3 id="schuld-modal-title">Details</h3>
        <div id="schuld-modal-list"></div>
        <button id="schuld-modal-close">Schließen</button>
    </div>
</div>

    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    /* === Notizen-Funktion === */
    const textarea = document.getElementById("notizen-textarea");
    textarea.value = localStorage.getItem("notizenText") || "";

    textarea.addEventListener("input", () => {
        localStorage.setItem("notizenText", textarea.value);
    });

    textarea.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
            const cursorPos = textarea.selectionStart;
            const text = textarea.value;
            const lines = text.split("\n");
            let currentLineIndex = 0, charCount = 0;
            for (let i = 0; i < lines.length; i++) {
                charCount += lines[i].length + 1;
                if (cursorPos <= charCount) { currentLineIndex = i; break; }
            }
            let line = lines[currentLineIndex].trim();
            if (line.includes("=")) {
                try {
                    const expression = line.replace("=", "").trim();
                    const result = eval(expression);
                    lines[currentLineIndex] = `${expression} = ${result}`;
                    textarea.value = lines.join("\n");
                    localStorage.setItem("notizenText", textarea.value);
                    const newPos = lines.slice(0, currentLineIndex + 1).join("\n").length;
                    textarea.setSelectionRange(newPos, newPos);
                    e.preventDefault();
                } catch {}
            }
        }
    });

    /* === Schulden-Tracker === */
    const schuldName = document.getElementById("schuld-name");
    const schuldBetrag = document.getElementById("schuld-betrag");
    const schuldAdd = document.getElementById("schuld-add");
    const schuldListe = document.getElementById("schuld-liste");
    const schuldSumme = document.getElementById("schuld-summe");

    function ladeSchulden() {
    const schulden = JSON.parse(localStorage.getItem("schulden") || "[]");

    // Summieren + Details speichern
    const zusammenfassung = {};
    schulden.forEach(({ name, betrag, datum }) => {
        if (!zusammenfassung[name]) zusammenfassung[name] = { summe: 0, eintraege: [] };
        zusammenfassung[name].summe += parseFloat(betrag);
        zusammenfassung[name].eintraege.push({ betrag: parseFloat(betrag), datum });
    });

    schuldListe.innerHTML = "";
    let summe = 0;

    Object.entries(zusammenfassung).forEach(([name, data]) => {
        summe += data.summe;

        const row = document.createElement("div");
        row.className = "schuld-item";

        const text = document.createElement("span");
        text.textContent = `${name}: ${data.summe.toFixed(2)} €`;

        const btnContainer = document.createElement("div");
        btnContainer.style.display = "flex";
        btnContainer.style.gap = "6px";

        // Info-Button → Modal öffnen
        const infoBtn = document.createElement("button");
        infoBtn.textContent = "ℹ️";
        infoBtn.title = "Details anzeigen";
        infoBtn.addEventListener("click", () => {
            const modal = document.getElementById("schuld-modal");
            const modalTitle = document.getElementById("schuld-modal-title");
            const modalList = document.getElementById("schuld-modal-list");

            modalTitle.textContent = `Details für ${name}`;
            modalList.innerHTML = "";

            data.eintraege.forEach((e, i) => {
                const detailRow = document.createElement("div");
                detailRow.className = "schuld-detail-row";

                const detailText = document.createElement("span");
                detailText.textContent = `${e.betrag.toFixed(2)} € am ${e.datum}`;

                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "🗑️";
                deleteBtn.addEventListener("click", () => {
                    const alle = JSON.parse(localStorage.getItem("schulden") || "[]");
                    alle.splice(alle.findIndex(item =>
                        item.name === name &&
                        item.betrag === e.betrag &&
                        item.datum === e.datum
                    ), 1);
                    localStorage.setItem("schulden", JSON.stringify(alle));
                    ladeSchulden();
                    modal.style.display = "none";
                });

                detailRow.appendChild(detailText);
                detailRow.appendChild(deleteBtn);
                modalList.appendChild(detailRow);
            });

            modal.style.display = "flex";
        });

        // Löschen-Button
        const del = document.createElement("button");
        del.textContent = "🗑️";
        del.title = "Alle Einträge löschen";
        del.addEventListener("click", () => {
            const neu = schulden.filter(e => e.name !== name);
            localStorage.setItem("schulden", JSON.stringify(neu));
            ladeSchulden();
        });

        btnContainer.appendChild(infoBtn);
        btnContainer.appendChild(del);

        row.appendChild(text);
        row.appendChild(btnContainer);
        schuldListe.appendChild(row);
    });

    schuldSumme.textContent = `Gesamt: ${summe.toFixed(2)} €`;
    schuldSumme.style.color = summe >= 0 ? "green" : "red";
}

// Modal schließen
document.getElementById("schuld-modal-close").addEventListener("click", () => {
    document.getElementById("schuld-modal").style.display = "none";
});
document.getElementById("schuld-modal").addEventListener("click", (e) => {
    if (e.target.id === "schuld-modal") {
        document.getElementById("schuld-modal").style.display = "none";
    }
});

// Beim Hinzufügen das Datum speichern
schuldAdd.addEventListener("click", () => {
    const name = schuldName.value.trim();
    const betrag = parseFloat(schuldBetrag.value);
    if (!name || isNaN(betrag)) return;
    const schulden = JSON.parse(localStorage.getItem("schulden") || "[]");
    const datum = new Date().toLocaleDateString();
    schulden.push({ name, betrag, datum });
    localStorage.setItem("schulden", JSON.stringify(schulden));
    schuldName.value = "";
    schuldBetrag.value = "";
    ladeSchulden();
});


    ladeSchulden();
});

document.addEventListener("DOMContentLoaded", () => {
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll("#tab-content > div");

    tabButtons.forEach(button => {
        button.addEventListener("click", () => {
            // Alle Buttons und Inhalte zurücksetzen
            tabButtons.forEach(b => b.classList.remove("active"));
            tabContents.forEach(c => c.style.display = "none");

            // Aktiven Button markieren
            button.classList.add("active");

            // Passenden Content anzeigen
            const tabId = button.id.replace("tab-", "tab-content-");
            document.getElementById(tabId).style.display = "block";
        });
    });
});
</script>
<!-- ======================================= Notizen-Tab Ende ======================================= -->


  <!-- ================= PLUS-BUTTON & Formular für Eintrag ================= -->
<!-- ================= PLUS-BUTTON & Formular für Eintrag ================= -->
 </div>
<button id="plus-button">+</button>

  <!-- Popup-Overlay hinter plus button-->
  <div id="popup-overlay">
    <div id="popup">
      <button id="popup-close">&times;</button>
      <h2>Neuer Eintrag</h2>

      <!-- Buttons für Typ -->
      <div id="typ-buttons">
        <button type="button" class="typ-btn" data-typ="einnahme">Einzahlung</button>
        <button type="button" class="typ-btn" data-typ="investition">Invest</button>
        <button type="button" class="typ-btn" data-typ="ausgabe">Auszahlung</button>
      </div>

      <!-- Formular -->
<form id="popup-form">
  <input type="hidden" id="popup-typ" name="typ" required />

  <table>
    <tr>
  <td colspan="2">
    <div class="betrag-row1">
      <label for="popup-betrag">Betrag:</label>
      <input type="text" id="popup-betrag" name="betrag" placeholder="Betrag (€)" readonly required />
    </div>
  </td>
</tr>
  
  
<tr>
  <td>
    <div id="virtual-keyboard" style="display:none;">
  <div class="vk-row">
    <button type="button" class="vk-btn operator">+</button>
    <button type="button" class="vk-btn operator">-</button>
    <button type="button" class="vk-btn operator">×</button>
    <button type="button" class="vk-btn operator">÷</button>
  </div>
  <div class="vk-row">
    <button type="button" class="vk-btn">7</button>
    <button type="button" class="vk-btn">8</button>
    <button type="button" class="vk-btn">9</button>
    <button type="button" id="vk-equal" class="vk-btn operator">=</button>
  </div>
  <div class="vk-row">
    <button type="button" class="vk-btn">4</button>
    <button type="button" class="vk-btn">5</button>
    <button type="button" class="vk-btn">6</button>
    <button type="button" class="vk-btn comma">.</button>  <!-- Klasse "comma" hinzu -->
  </div>
  <div class="vk-row">
    <button type="button" class="vk-btn">1</button>
    <button type="button" class="vk-btn">2</button>
    <button type="button" class="vk-btn">3</button>
    <button type="button" id="vk-backspace" class="vk-btn backspace">←</button> <!-- Klasse "backspace" hinzu -->
  </div>
  <div class="vk-row">
    <div style="flex:1"></div>
    <button type="button" class="vk-btn" style="flex: 1;">0</button>  <!-- 0 mittig -->
    <div style="flex:1"></div>
    <button type="button" id="vk-ok" class="vk-btn ok-btn">OK</button>
  </div>
</div>

  </td>
</tr>

<tr>

</tr>

    <tr>
  <td colspan="2">
    <div class="kategorie-row1">
      <label for="wordSelect">Kategorie:</label>
      <select id="wordSelect">
        <option disabled selected>Keine Wörter verfügbar</option>
      </select>
    </div>
  </td>
</tr>

    <tr>
  <td colspan="2">
    <div class="datum-row1">
      <label for="popup-datum">Datum:</label>
      <input type="date" id="popup-datum" name="datum" required />
    </div>
  </td>
</tr>

  </table>

  <button type="submit">Hinzufügen</button>
</form>


<!-- ================= SCRIPTS ================= -->
<!-- JavaScript -->
 <!-- Plus-Button Popup Logik -->
<script>
function waehleTyp(typ) {
  const alleTypBtns = document.querySelectorAll(".typ-btn");
  const popupTyp = document.getElementById("popup-typ");

  alleTypBtns.forEach(btn => {
    if (btn.dataset.typ === typ) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });

  popupTyp.value = typ;
}

document.getElementById("plus-button").addEventListener("click", () => {
  const popupOverlay = document.getElementById("popup-overlay");
  const popupDatum = document.getElementById("popup-datum");

  popupOverlay.style.display = "flex";
  popupDatum.value = ausgewaehltesDatum;

  waehleTyp("ausgabe");  // Standardmäßig "Ausgabe" aktivieren
  updateSelect();        // Falls du diese Funktion brauchst
});
</script>


<!-- Plus-Button Popup Logik Ende -->

<script>
  const words = [];
</script>

<script>
document.querySelectorAll('.typ-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const selectedTyp = btn.dataset.typ;
    document.getElementById('popup-typ').value = selectedTyp;

    // Aktive Klasse setzen
    document.querySelectorAll('.typ-btn').forEach(b => {
      b.classList.toggle('active', b.dataset.typ === selectedTyp);
    });

    // Kategorien neu laden, falls relevant
    updateSelect();
  });
});



  let kategorien = {
  einnahme: [],
  ausgabe: []
};

// Beim Laden die Kategorien aus localStorage wiederherstellen
const gespeicherteKategorien = localStorage.getItem('kategorien');
if (gespeicherteKategorien) {
  try {
    kategorien = JSON.parse(gespeicherteKategorien);
  } catch (e) {
    console.error('Fehler beim Parsen gespeicherter Kategorien:', e);
  }
}
// Beim Laden die Kategorien aus localStorage wiederherstellen Ende


  function updateSelect() {
  const select = document.getElementById('wordSelect');
  const typ = document.getElementById('popup-typ').value;
  select.innerHTML = '';

  const kategorieListe = kategorien[typ] || [];

  if (kategorieListe.length === 0) {
    const option = document.createElement('option');
    option.text = 'Keine Kategorien verfügbar';
    option.disabled = true;
    option.selected = true;
    select.add(option);
    return;
  }

  kategorieListe.forEach(word => {
    const option = document.createElement('option');
    option.text = word;
    select.add(option);
  });
}

  function addWord() {
  const input = document.getElementById('wordInput');
  const typAuswahl = document.getElementById('typ-auswahl');
  const typ = typAuswahl.value;
  const word = input.value.trim();

  if (word && !kategorien[typ].includes(word)) {
    kategorien[typ].push(word);

    // ✅ Kategorien speichern
    localStorage.setItem('kategorien', JSON.stringify(kategorien));

    input.value = '';
    updateKategorieListe();

    if (document.getElementById('popup-typ').value === typ) {
      updateSelect();
    }
  }
}

  function updateKategorieListe() {
  const ul = document.getElementById('kategorie-liste');
  const typ = document.getElementById('typ-auswahl').value;
  ul.innerHTML = '';

  kategorien[typ].forEach((word, index) => {
    const li = document.createElement('li');
    li.style.display = 'flex';
    li.style.justifyContent = 'space-between';
    li.style.alignItems = 'center';

    const text = document.createElement('span');
    text.textContent = word;

    const loeschenBtn = document.createElement('button');
    loeschenBtn.textContent = '❌';
    loeschenBtn.style.marginLeft = '10px';
    loeschenBtn.style.cursor = 'pointer';
    loeschenBtn.style.border = 'none';
    loeschenBtn.style.background = 'transparent';
    loeschenBtn.style.color = 'red';

    loeschenBtn.addEventListener('click', () => {
      kategorien[typ].splice(index, 1);
      localStorage.setItem('kategorien', JSON.stringify(kategorien));
      updateKategorieListe();
      // Wenn im Popup1 dieselbe Kategoriegruppe aktiv ist, Liste auch dort aktualisieren
      if (document.getElementById('popup-typ').value === typ) {
        updateSelect();
      }
    });

    li.appendChild(text);
    li.appendChild(loeschenBtn);
    ul.appendChild(li);
  });
}


  document.getElementById('typ-auswahl').addEventListener('change', () => {
    updateKategorieListe();
  });

  
</script>





<!-- Popup-Overlay fertig -->

<!-- Popup2 für Einstellungen -->
<!-- Popup2 für Einstellungen -->


<div id="popup2-overlay" style="
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 1000;
">
  <div id="popup2" style="
    background: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    width: 90%;
    position: relative;
  ">
    <button id="popup2-close" style="
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.5rem;
      cursor: pointer;
      border: none;
      background: transparent;
    ">&times;</button>
    <h2>Einstellungen</h2>
    <p>Hier kannst du deine Einstellungen anpassen.</p>
     <!-- Füge hier deine Einstellungsfelder hinzu -->
      <!-- Einstellungsfeld für dynamische Kategorien -->
<div id="kategorie-verwalten">
  <h3>Kategorien verwalten</h3>

  <label for="typ-auswahl">Typ:</label>
  <select id="typ-auswahl">
    <option value="einnahme">Einzahlung</option>
    <option value="ausgabe">Auszahlung</option>
    <option value="investition">Investition</option>
  </select>

  <input type="text" id="neue-kategorie" placeholder="Neue Kategorie..." />

  <button id="hinzufuegen-kategorie">Hinzufügen</button>

  <ul id="kategorie-liste"></ul>
</div>



  </div>
</div>

<!--  Auslagerung 1.3 -->

<!-- Popup2 für Einstellungen fertig -->

<!-- Hilfsfunktion für Budget aktuallisieren -->
 <script>
  function berechneMonatsuebersicht(jahr, monat) {
  let einnahmen = 0;
  let ausgaben = 0;

  // Einnahmen und Ausgaben berechnen
  alleEintraege.forEach(eintrag => {
    const eintragsDatum = new Date(eintrag.datum);
    if (
      eintragsDatum.getFullYear() === jahr &&
      eintragsDatum.getMonth() === monat
    ) {
      if (eintrag.typ === "einnahme") {
        einnahmen += eintrag.betrag;
      } else if (eintrag.typ === "ausgabe") {
        ausgaben += eintrag.betrag;
      }
    }
  });

  const budget = einnahmen - ausgaben;

  // DOM-Elemente holen
  const einnahmenElement = document.getElementById("monat-einnahmen");
  const ausgabenElement = document.getElementById("monat-ausgaben");
  const budgetElement = document.getElementById("monat-budget");

  // Werte aktualisieren
  einnahmenElement.textContent = `${einnahmen.toFixed(2)} €`;
  ausgabenElement.textContent = `${ausgaben.toFixed(2)} €`;
  budgetElement.textContent = `${budget.toFixed(2)} €`;

  // Klassen dynamisch setzen für Farbe
  budgetElement.classList.remove("positiv", "negativ");
  if (budget >= 0) {
    budgetElement.classList.add("positiv");  // blau (CSS siehe unten)
  } else {
    budgetElement.classList.add("negativ");  // rot
  }
}

</script>
<!-- Hilfsfunktion für Budget aktualisieren Ende -->




  <script src="script.js"></script>

</body>
</html>


<!---========================= HIER HTML Ende aber ohne Schluss===========================-->


<script>
  //========================= HIER JS ===========================//


  //========================= HIER JS Ende ===========================//
</script>




<style>
/*---========================= HIER css ===========================-->*/


/*---========================= HIER css Ende ===========================-*/
</style>


<!-- wohl irgendetwas für offline -->
 <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }
</script>

  <script src="script.js"></script>

</body>
</html>
